generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
model User {
  id          String         @id @default(cuid())
  username    String         @unique
  password    String 
  email       String         @unique
  refreshToken String?
  role        Role @default(User)
  userDetails UserDetail?
  posts       Post[]
  likes       Like[]
  comments    Comment[]
  notifications Notification[]
  follower    Follow[]       @relation("Follower")
  following   Follow[]       @relation("Following")
}

enum Role {
  User
  Seller
  Admin
}

model UserDetail {
  id       String @id @default(cuid())
  userId   String @unique
  user     User   @relation(fields: [userId], references: [id])
  image    String?
  name     String?
  bio      String?
  status   StatusUser @default(public)
}

enum StatusUser {
  private
  public
  deactive
}

model Post {
  id        String         @id @default(cuid())
  userId    String
  user      User        @relation(fields: [userId], references: [id])
  content   String
  status    StatusPost @default(public)
  createdAt DateTime    @default(now())
  likes     Like[]
  comments  Comment[]
  reports   Report[]
  images    PostImage[]
}

enum StatusPost {
  public
  archive
}

model PostImage {
  id        String    @id @default(cuid())
  postId    String
  post      Post        @relation(fields: [postId], references: [id])
  image     String
}

model Like {
  id     String    @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])
  postId String
  post   Post   @relation(fields: [postId], references: [id])
}

model Notification {
  id        String      @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  message   String
  createdAt DateTime @default(now())
}

model Comment {
  id        String       @id @default(cuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id])
  postId    String
  post      Post      @relation(fields: [postId], references: [id])
  content   String
  parentId  String?
  parent    Comment?  @relation("Replies", fields: [parentId], references: [id])
  replies   Comment[] @relation("Replies")
  createdAt DateTime  @default(now())
}

model Follow {
  id           String    @id @default(cuid())
  followerId   String
  follower     User   @relation("Follower", fields: [followedId], references: [id])
  followedId   String
  followed     User   @relation("Following", fields: [followerId], references: [id])
  createdAt    DateTime @default(now())
  
  @@unique([followerId, followedId]) // Menambahkan unique constraint
}

model Report {
  id          String      @id @default(cuid())
  postId      String
  post        Post     @relation(fields: [postId], references: [id])
  createdAt   DateTime @default(now())
}



/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
// model prisma_migrations {
// @@map("_prisma_migrations")
// }
